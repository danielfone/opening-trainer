#!/usr/bin/env bash
# exit on error
set -o errexit

# Update the bundle
bundle install

# Download the puzzle db if we don't have it in the build
[ -f "data/lichess_db_puzzle.csv" ] || curl https://database.lichess.org/lichess_db_puzzle.csv.bz2 | bunzip2 --verbose --stdout > data/lichess_db_puzzle.csv

#
# ALTERNATIVELY, for a more sophisticated approach...
#

# Fetch the puzzle db if a newer one exists
# curl --time-cond data/lichess_db_puzzle.csv.bz2 --output data/lichess_db_puzzle.csv.bz2 https://database.lichess.org/lichess_db_puzzle.csv.bz2

# Unzip the puzzles if we have a newer db
# if [ "data/lichess_db_puzzle.csv" -ot "data/lichess_db_puzzle.csv.bz2" ]; then
#   bunzip2 --verbose data/lichess_db_puzzle.csv.bz2
# fi
